<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="${ctx_path}/css/styles.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="${ctx_path}/js/jquery.js"></script>
<script type="text/javascript" src="${ctx_path}/js/commons.js"></script>
<script type="text/javascript" src="${ctx_path}/js/My97DatePicker/WdatePicker.js"></script>
           <!--[if lte IE 6]>
<script type="text/javascript" src="${ctx_path}/js/DD_belatedPNG_0.0.8a.js"></script>
    <script type="text/javascript">
        DD_belatedPNG.fix('div, ul, img, li , a, a:hover,h3,.caption, p');
    </script>
<![endif]--> 
<title>项目基本情况 </title>
<script type="text/javascript">
function getByteLen(val) {
    var len = 0;
    for (var i = 0; i < val.length; i++) {
        if (val[i].match(/[^\x00-\xff]/ig) != null) //全角
            len += 2;
        else
            len += 1;
    }
    return len;
}
   function check()
   {	    	  	   
	    var Category=document.getElementById("Category").value;
	    var Group=document.getElementById("Group").value;
	    var ProjectCN=document.getElementById("ProjectCN").value;
	    // var ProjectEN=document.getElementById("ProjectEN").value;
	     var StartTime=document.getElementById("StartTime").value;
	     var EndTime=document.getElementById("EndTime").value;
	     var RecommendCompany=document.getElementById("RecommendCompany").value;
	     var PlanFund=document.getElementById("PlanFund").value;
	     
	     
	     var ts="";
	     if(Category=="")
	     {
	    	 ts+="请选择评奖类别;\n";
	     }
	     if(Group=="")
	     {
	    	 ts+="请选择专业审核组;\n";
	     }
	     if(ProjectCN=="")
	     {
	    	 ts+="请输入项目中文名称;\n";
	     }if(getByteLen(ProjectCN)>120){
    		 ts+="项目中文名称字数不能超过60个!\n"; 
    	 }	    
	     if(StartTime=="")
	     {
	    	 ts+="请输入项目开始时间;\n";
	     }
	     if(EndTime=="")
	     {
	    	 ts+="请输入项目结束时间;\n";
	     }
	     if(StartTime!="" && EndTime!="")
    	 {
    	     if(StartTime>EndTime)
    	     {
    	    	 ts+="开始时间不能大于结束时间;";
    	     }
    	 }
	   /*   if(PlanFund!="")
	     {
	    	if(getByteLen(PlanFund)>480){
    		 ts+="计划（基金）名称和编号字数不能超过240个!\n"; 
	    	}
    	 }
	      */
	     if(RecommendCompany!="")
	     {
	    	if(getByteLen(RecommendCompany)>60){
    		 ts+="推荐名称字数不能超过30个!\n"; 
	    	}
    	 }
	     
	     if(ts!=""){
	    	 alert(ts);
	    	 return false;
	     }
	    	 
	     
	     //任务来源赋值 
         var check = document.getElementsByName("FromTaskAll");
		 var len=check.length;
		 var idAll="";
		 for(var i=0;i<len;i++)
		 {
			 if(check[i].checked)
			 {
				 idAll+=check[i].value+",";
			 }
			 
		 }
		 idAll=idAll.substr(0, idAll.length-1);
		 self['FromTask'].value =idAll;
   }
   
   
   function load()
   {
	   //如果是 新增 隐藏导出按钮
	   if(${st!}=="1")
	   {
		   document.getElementById("projectOut").style.display = "none";
	   }else if(${st!}=="2")
	   {
		   document.getElementById("projectOut").style.display = "block";
	   }
	   
	   var Secret='${project.Secret!}';  //是否保密
	   if(Secret=='1')
	   {
		   document.getElementById("SecretTime").style.display = "block";
	   }else
	   {
		   document.getElementById("SecretTime").style.display = "none";
	   }   
	   document.getElementById("Group").value='${project.GroupZY!}';
	   document.getElementById("Category").value='${project.Category!}';
	   
	  //申报状态是否已结束  如果结束 不能提交操作
	 // var StatusSb='${prize.StatusSb!}';
	//  if(StatusSb=='0')  //结束  隐藏申报按钮
	 // {
		// $(document.getElementById("send")).hide();
	//	 $(document.getElementById("send"));
	  //}
	  
	  /* var status='${project.Status!}'; //等于0未提交 3形式审查未审核通过的项目 才能操作 
	  if(status !='0' && status!='3')
	  {
		 // $(document.getElementById("send")).hide();
		  $(document.getElementById("send"));
	  } */
	  var FromOther = '${project.FromOther!}';
	  if(FromOther!=""){
		  $("#FromOther").show();
	  } 
	  
	   
   }
   
 
 //验证是否保密 隐藏保密期限按钮
  function checkRadio(value)
 {
	 //1是  0否
	 if(value==1)     //显示
     {
		 document.getElementById("SecretTime").style.display = "block";
     }else if(value==0)
     {
    	 document.getElementById("SecretTime").style.display = "none";
     }	 
	  
 }
 function setFromOther(name){
	 if(name=="其他"){
		 if($("#FromOther").is(":visible")==false){
			 $("#FromOther").show(); 
		 }else{
			 $("#FromOther").hide();
		 }
		
	 }
 }
</script>

<style>
form input.text {
width: 330px;
}
</style>

</head>

<body onload="load()">
<#include "/common/_header.html"/>
<@header username=user.Username detailUrl="${ctx_path}/company/detail"/>

<div class="container_12">

	<#include "/project/_step_topmenu.html"/>
	
     <div class="clearfix"></div>
      <h5><b>项目基本情况</h5>
      <form action="${ctx_path}/project/apply" method="post" onSubmit="return check()">
          <input type="hidden" name="step" value='1'/> 
          <input type="hidden" name="id" value='${project.id!}'/>
          <input type="hidden" name="project.id" value='${project.id!}'/> 
           <table   width="100%" border="0" cellpadding="0" cellspacing="0">   
            <tr><td><label for="cbo" class="pad">评奖类别:<label style='color:red'>*</label></label> </td>
            <td><select name="project.Category" id="Category" class="select" >
             <#list categoryList as x>
                <option value="${x.id}">${x.Name!}</option>
             </#list>                          
            </select></td></tr>
           
             <tr><td><label for="cbo" class="pad" >专业评审组:<label style='color:red'>*</label></label></td>   
            <td><select name="project.GroupZY" id="Group" class="select" >
            	 <#list groupList as x>
               	 <option value="${x.id}">${x.Name!}</option>
             	</#list> 
               
            
            </select></td></tr>

           <tr><td><label class="pad">项目中文名称:<label style='color:red'>*</label></label></td>
           <td><input type="text" id="ProjectCN"  name="project.ProjectCN" class="text" value='${project.ProjectCN!}' /></td></tr>

     <!--      <tr><td><label class="pad">项目英文名称:<label style='color:red'>*</label></label></td>
          <td><input type="text" id="ProjectEN"  name="project.ProjectEN" class="text" value='${project.ProjectEN!}' /></td></tr>  --> 

         <tr><td><label class="pad">起止时间:<label style='color:red'>*</label></label></td>
	          <td>
	            <input class="Wdate" type="text" id="StartTime" name="project.StartTime" onFocus="WdatePicker({isShowClear:false,readOnly:true})" value='${project.StartTime!}'/>-
	            <input class="Wdate" type="text" id="EndTime" name="project.EndTime" onFocus="WdatePicker({isShowClear:false,readOnly:true})" value='${project.EndTime!}' />
	          </td>
          </tr>

          <tr>
           <td><label class="pad">任务来源:</label></td>
           <td><p> <input type="hidden" name="project.FromTask" id="FromTask"/>
               <#assign fz='${ftsize!}'>
               <#if fz=='0'>
               
                    <#list fromtaskList as x >
           		         <input type="checkbox" class="checkbox" onclick="setFromOther('${x.Name!}')" name="FromTaskAll" value="${x.id!}"  /> 
                         <label for="cbdemo1">${x.Name!}</label>  
           		  </#list> 
                     
               <#else>
               <!-- 根据后台传过来的值 默认被选中的多选框 -->
                   <#global content="">
					<#list fromtaskList as x  >
					   <#assign chk="<input type='checkbox'  class='checkbox' onclick='setFromOther(&apos;${x.Name!}&apos;)' name='FromTaskAll' value='${x.id!}'  /><label for='cbdemo1'>${x.Name!}</label>" >     
					   
						 <#list ftList as f >
						     <#if x.id=f.id>
						     		 <#assign chk="<input type='checkbox'  class='checkbox' onclick='setFromOther(&apos;${x.Name!}&apos;)' name='FromTaskAll' value='${x.id!}' checked='checked' />
						     		 <label for='cbdemo1'>${x.Name!}</label>" >
						         <#break> 
						     </#if>
						 </#list> 
						 <#global content=content + chk>
					</#list>
					${content}
                  
               </#if>
           			<input type="text" id="FromOther" name="project.FromOther" value='${project.FromOther!}' class="text" style="display:none"/>
                </p></td>
           </tr>
           <tr>
                 <td > <label class="pad">计划（基金）名称和编号:</label></td>
                  <td><textarea name="project.PlanFund" id="PlanFund" cols="20" rows="3" style=" width:500px;" >${project.PlanFund!}</textarea><span style="color: red;">不同计划（基金）名称和编号用“；”隔开</span></td>
           </tr>
           <tr>
               <td><label for="RADIO1" class="pad">是否保密</label></td>
                  <td><p>
                  <#if project.Secret??>
                     <#if project.Secret == 1 >
                          <input type="radio"  name="project.Secret" id="Secret" value="1" checked="checked"  onclick="checkRadio(value)" />
		                  <label for="RADIO1">是</label>
		                  <input type="radio"   name="project.Secret" id="Secret" value="0" onclick="checkRadio(value)" />
		                  <label for="RADIO1">否</label>
		              <#else>
		                  <input type="radio"  name="project.Secret" id="Secret" value="1" onclick="checkRadio(value)" />
		                  <label for="RADIO1">是</label>
		                  <input type="radio"   name="project.Secret" id="Secret" value="0" checked="checked"  onclick="checkRadio(value)" />
		                  <label for="RADIO1">否</label>   
		               </#if>
		           <#else>
		              <input type="radio"  name="project.Secret" id="Secret" value="1"   onclick="checkRadio(value)" />
	                  <label for="RADIO1">是</label>
	                  <input type="radio"   name="project.Secret" id="Secret" value="0" checked="checked" onclick="checkRadio(value)" />
	                  <label for="RADIO1">否</label>    
                  </#if>
                  </p></td>
           </tr>
           <tr>
	           <td><label class="pad">保密期限:</label></td>
	           <td> <input type="text" id="SecretTime" name="project.SecretTime"  class="text" value='${project.SecretTime!}' /></td></tr>
           <tr>
	           <td><label class="pad">推荐单位:</label></td>
	           <td><input type="text" id="RecommendCompany" name="project.RecommendCompany" class="text" value='${project.RecommendCompany!}' /></td></tr>
           </table>
           
      
	<div class="anniu">
	<#if  project.Status==0 || project.Status==3>
		<input value="保存" type="submit"  class="login" id="send"/>
	</#if>
	  <a id="projectOut"  href="${ctx_path}/project/projectOut?id=${project.id!}" class="register" title="导出" >导出</a>
	  <a href="javascript:history.go(-1)" class="register" title="返回" >返回</a>
	</div>
</form>
</div>
</body>
</html>
